<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   width="1280" height="720"
			   backgroundColor="0x000000"
			   creationComplete="init()" creationPolicy="all">
	<fx:Style source="SteamingVideoApp.css"/>
	
	<s:states>
		<s:State name="default"/>
		<s:State name="browse"/>
		<s:State name="results"/>
	</s:states>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import com.lnet.streamingvideo.data.CategoriesXMLLoader;
			import com.lnet.streamingvideo.events.ApplicationEvent;
			import com.lnet.streamingvideo.events.ApplicationEventBus;
			import com.lnet.streamingvideo.services.VideoService;
			import com.lnet.streamingvideo.utils.KeyHandler;
			import com.lnet.streamingvideo.viewmodels.BrowseViewModel;
			import com.lnet.streamingvideo.viewmodels.PlayerViewModel;
			import com.lnet.streamingvideo.viewmodels.SearchViewModel;
			import com.lnet.streamingvideo.views.BrowseView;
			import com.lnet.streamingvideo.views.PlayerView;
			import com.lnet.streamingvideo.views.SearchResultsView;
			import com.lnet.streamingvideo.views.SearchView;
			
			private var searchView:SearchView;
			private var searchViewModel:SearchViewModel;
			private var searchResultsView:SearchResultsView;
			private var playerView:PlayerView;
			private var playerViewModel:PlayerViewModel;
			private var browseView:BrowseView;
			private var keyHandler:KeyHandler;
			private var videoService:VideoService;
			private var categoriesXML:CategoriesXMLLoader;
			
			private function init():void {
//				Security.allowDomain("www.youtube.com");
//				keyHandler = new KeyHandler();
				videoService = new VideoService();
				categoriesXML = new CategoriesXMLLoader();
				playerViewModel = new PlayerViewModel();
				createSearchResultsView();
				createBrowseView();
				createPlayerView();
			}

//			private function createSearchView(vm:SearchViewModel):void {
//				searchView = new SearchView();
//				searchView.searchViewModel = vm;
//				searchBoxContainer.addElement(searchView);
//			}
			
			private function createSearchResultsView():void {
				searchResultsView = new SearchResultsView();
				searchResultsView.searchViewModel = new SearchViewModel();
				resultlist.addElement(searchResultsView);
			}
						
			private function createPlayerView():void {
				ApplicationEventBus.getInstance().addEventListener(ApplicationEvent.VIDEO_SELECTED, showPlayerView,
					false, 0, true);
				playerView = new PlayerView();
				playerView.playerViewModel = playerViewModel;
				playerContainer.addElement(playerView);
			}
			
			private function showPlayerView(e:Event=null):void {
				container.selectedChild = playerViewStack;
				//container.addElement(playerView);
			}
			
			private function createBrowseView():void {
				browseView = new BrowseView();
				browseView.browseViewModel = new BrowseViewModel();
				categorylist.addElement(browseView);
			}			
		]]>
	</fx:Script>
	
	<s:BorderContainer id="background"
					   width="1280" height="720"
					   backgroundAlpha="1"
					   backgroundImage="@Embed(source='assets/Texture.png')">
		<mx:ViewStack id="container"
					  width="100%" height="100%">
			<s:NavigatorContent id="searchViewStack">
				<s:layout>
					<s:HorizontalLayout/>
				</s:layout>
				<s:BorderContainer id="categorylist"
								   width="323" height="720"
								   borderVisible="false"
								   backgroundAlpha="1"
								   backgroundImage="@Embed(source='assets/LeftPanelBackground.png')"/>
				<s:BorderContainer id="rightpane"
								   width="100%" height="100%">
					<s:layout>
						<s:VerticalLayout/>
					</s:layout>
					<s:Group id="searchbar" height="100" width="100%"/>
					<s:Group id="resultlist" height="100%" width="100%"/>
				</s:BorderContainer>
			</s:NavigatorContent>
			<s:NavigatorContent id="playerViewStack">
				<s:Group id="playerContainer" width="100%" height="100%"/>
			</s:NavigatorContent>
		</mx:ViewStack>
	</s:BorderContainer>
</s:Application>
